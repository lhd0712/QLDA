<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Day</title>
	<style>
		body {
			font-family: system-ui;
		}
		.calendar-container {
			position: absolute;
			top: 30px;
			right: 40px;
			background: #fff;
			border-radius: 10px;
			box-shadow: 0 2px 8px #0002;
			padding: 20px;
			width: 320px;
		}
		.calendar-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 10px;
		}
		.calendar-header button {
			background: #0B41FF;
			color: #fff;
			border: none;
			border-radius: 4px;
			padding: 4px 10px;
			font-size: 16px;
			cursor: pointer;
		}
		.calendar-header span {
			font-size: 18px;
			font-weight: bold;
		}
		table.calendar {
			width: 100%;
			border-collapse: collapse;
			text-align: center;
		}
		table.calendar th, table.calendar td {
			padding: 6px;
			font-size: 15px;
		}
		table.calendar th {
			color: #0B41FF;
		}
		table.calendar td.selected {
			background: #0B41FF;
			color: #fff;
			border-radius: 50%;
		}
		table.calendar td:hover {
			background: #e6f0ff;
			cursor: pointer;
			border-radius: 50%;
		}
	</style>
</head>
<body>
	<div style="background: #FFFFFF; min-height: 100vh; position: relative;">
        <div class="calendar-container" id="calendar-box" style="display: none;">
            <div class="calendar-header">
                <button onclick="changeMonth(-1)">&lt;</button>
                <span id="calendar-month"></span>
                <button onclick="changeMonth(1)">&gt;</button>
            </div>
            <table class="calendar">
                <thead>
                    <tr>
                        <th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th>
                    </tr>
                </thead>
                <tbody id="calendar-body">
                    <!-- Calendar days will be rendered here -->
                </tbody>
            </table>
        </div>
		<div style="background: #FFFFFF;">
		<div style="align-self: stretch; display: flex; align-items: flex-start; background: #FFFFFF; border-radius: 6px; margin-top: 102px; margin-bottom: 1px; box-shadow: 0px 14px 21px #00000040;">
			<div style="flex-shrink: 0; display: flex; flex-direction: column; align-items: flex-start; background: #FFFFFF; padding-bottom: 245px; min-width: 260px;">
				<div id="calendar-container" style="width: 240px; padding: 16px;">
					<div style="display: flex; justify-content: space-between; align-items: center;">
						<button id="prevMonth" style="background: none; border: none; font-size: 18px; cursor: pointer;">&#8592;</button>
						<span id="calendarMonth" style="color: #333; font-size: 18px; font-weight: bold;"></span>
						<button id="nextMonth" style="background: none; border: none; font-size: 18px; cursor: pointer;">&#8594;</button>
					</div>
					<table id="calendar" style="width: 100%; margin-top: 10px; border-collapse: collapse; text-align: center;"></table>
				</div>
			</div>
			<div style="flex: 1;">
				<div style="align-self: stretch; display: flex; align-items: flex-start; background: #FFFFFF; border-bottom: 1px solid #DADCE099; padding: 6px 16px 16px 16px; margin-left: 1px; margin-right: 1px;">
					<div style="flex-shrink: 0; display: flex; align-items: center; margin-top: 10px;">
						<span style="color: #333333; font-size: 30px; font-weight: bold; margin-right: 21px;" >
							01 January 2022
						</span>
						<button style="flex-shrink: 0; display: flex; flex-direction: column; align-items: flex-start; background: none; border-radius: 3px; border: 1px solid #0B41FF; padding: 8px; text-align: left;"
							onclick="alert('Pressed!')"}>
							<span style="color: #0B41FF; font-size: 12px; font-weight: bold;" >
								Day
							</span>
						</button>
					</div>
					<div style="flex: 1; align-self: stretch;">
					</div>
					<img
						src="https://figma-alpha-api.s3.us-west-2.amazonaws.com/images/5ecd1f77-01c7-4e8f-a2f7-f57f1c4180d0" 
						style="width: 60px; height: 53px; margin-right: 19px; object-fit: fill; cursor: pointer; border-radius: 50%;"
						alt="avatar"
						onclick="window.location.href='/profile'"
					/>
					<div style="flex-shrink: 0; display: flex; align-items: center; margin-top: 14px; gap: 16px;">
						<div style="flex-shrink: 0; display: flex; align-items: center; background: #F5F5F5; border-radius: 99px; padding: 8px 8px 8px 16px;">
							<input
								type="text"
								placeholder="Enter Search"
								style="color: #6A778B; font-size: 14px; font-weight: bold; width: 161px; background: none; border: none;"
							/>
							<img
								src="https://figma-alpha-api.s3.us-west-2.amazonaws.com/images/5c0f54db-ffe1-4c35-b9e2-893e888c3290" 
								style="border-radius: 99px; width: 16px; height: 16px; object-fit: fill;"
							/>
						</div>
						<button style="flex-shrink: 0; display: flex; align-items: center; background: #0B41FF; border-radius: 3px; border: none; padding: 8px; gap: 4px; text-align: left;"
							onclick="alert('Pressed!')"}>
							<span style="color: #FFFFFF; font-size: 12px; font-weight: bold;" >
								Add event
							</span>
							<img
								src="https://figma-alpha-api.s3.us-west-2.amazonaws.com/images/97437b4c-b5ea-45f9-aeb1-75d8a938a534" 
								style="border-radius: 3px; width: 16px; height: 16px; object-fit: fill;"
							/>
						</button>
					</div>
				</div>
				<div style="align-self: stretch; display: flex; align-items: flex-start; margin-left: 1px; margin-right: 1px;">
					<div style="flex-shrink: 0; display: flex; flex-direction: column; align-items: center; width: 60px;">
						<!-- Render 24 time slots -->
						{% for hour in range(24) %}
							<div style="height: 48px; display: flex; align-items: center; justify-content: center; border-bottom: 1px solid #eee; width: 100%;">
								<span style="color: #333333; font-size: 12px; font-weight: bold;">{{ '%02d:00' % hour }}</span>
							</div>
						{% endfor %}
					</div>
					<div style="flex: 1;">
					  {% for hour in range(24) %}
					    <div style="height: 48px; box-sizing: border-box; align-self: stretch; background: #FFFFFF; border: 1px solid #61646A99; display: flex; align-items: flex-start; padding: 4px 8px; margin-bottom: 0; position: relative;">
					      {% set time_str = '%02d:00' % hour %}
					      {% for event in events if event.time == time_str %}
					        <div style="display: flex; flex-direction: column; align-items: flex-start; background: #BDFFDB; border-radius: 3px; border: 1px solid #8EDBB2; padding: 4px 8px; margin-bottom: 2px; gap: 2px; min-width: 120px;">
					          <div style="display: flex; justify-content: space-between; align-items: flex-start; width: 100%;">
					            <span style="color: #2C5A41; font-size: 12px; font-weight: bold;">{{ event.name }}</span>
					            <span style="color: #2C5A41; font-size: 12px; font-weight: bold;">{{ event.time }}</span>
					          </div>
					          <span style="color: #2C5A41; font-size: 11px;">{{ event.description }}</span>
					        </div>
					      {% endfor %}
					    </div>
					  {% endfor %}
					</div>
				</div>
			</div>
		</div>
	</div>
	<script>
	// Calendar logic
	const calendar = document.getElementById('calendar');
	const calendarMonth = document.getElementById('calendarMonth');
	const prevMonthBtn = document.getElementById('prevMonth');
	const nextMonthBtn = document.getElementById('nextMonth');

	let today = new Date();
	let currentMonth = today.getMonth();
	let currentYear = today.getFullYear();

	function renderCalendar(month, year, selectedDateStr = null) {
		const monthNames = [
			'January', 'February', 'March', 'April', 'May', 'June',
			'July', 'August', 'September', 'October', 'November', 'December'
		];
		calendarMonth.textContent = monthNames[month] + ' ' + year;
		const firstDay = new Date(year, month, 1).getDay();
		const daysInMonth = new Date(year, month + 1, 0).getDate();
		let html = '<tr>';
		const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
		for (let d of days) html += `<th style=\"color:#888;font-size:12px;\">${d}</th>`;
		html += '</tr><tr>';
		for (let i = 0; i < firstDay; i++) html += '<td></td>';
		for (let date = 1; date <= daysInMonth; date++) {
			if ((firstDay + date - 1) % 7 === 0 && date !== 1) html += '</tr><tr>';
			const isToday = date === today.getDate() && month === today.getMonth() && year === today.getFullYear();
			const thisDateStr = `${year}-${month+1}-${date}`;
			const isSelected = selectedDateStr === thisDateStr;
			// Ưu tiên selected, nếu đã chọn thì không bôi màu today nữa
			const isHighlight = isSelected ? 'selected' : '';
			const bgColor = isSelected ? '#0B41FF' : (isToday ? '#F5F5F5' : '#F5F5F5');
			const color = isSelected ? '#fff' : '#333';
			html += `<td class="${isHighlight}" style=\"padding:4px;\"><button class=\"calendar-day\" data-date=\"${thisDateStr}\" style=\"width:28px;height:28px;border-radius:50%;border:none;background:${bgColor};color:${color};font-weight:bold;cursor:pointer;\">${date}</button></td>`;
		}
		const lastDay = (firstDay + daysInMonth - 1) % 7;
		for (let i = lastDay + 1; i < 7 && lastDay !== 6; i++) html += '<td></td>';
		html += '</tr>';
		calendar.innerHTML = html;
		document.querySelectorAll('.calendar-day').forEach(btn => {
			btn.onclick = function() {
				const dateStr = this.getAttribute('data-date');
				selectedDate = dateStr;
				renderCalendar(currentMonth, currentYear, selectedDate);
				const mainDate = new Date(dateStr);
				const day = String(mainDate.getDate()).padStart(2, '0');
				const monthName = mainDate.toLocaleString('default', { month: 'long' });
				const year = mainDate.getFullYear();
				document.querySelectorAll('span[style*="font-size: 30px"]')[0].textContent = `${day} ${monthName} ${year}`;
				// TODO: fetch and show events for this date
			};
		});
	}

	let selectedDate = null;

	// Lấy ngày hiện tại làm ngày chọn mặc định khi load trang
	window.onload = function() {
		const defaultDate = new Date(currentYear, currentMonth, today.getDate());
		selectedDate = `${defaultDate.getFullYear()}-${defaultDate.getMonth()+1}-${defaultDate.getDate()}`;
		renderCalendar(currentMonth, currentYear, selectedDate);
		// Cập nhật ngày lớn
		const day = String(defaultDate.getDate()).padStart(2, '0');
		const monthName = defaultDate.toLocaleString('default', { month: 'long' });
		document.querySelectorAll('span[style*="font-size: 30px"]')[0].textContent = `${day} ${monthName} ${defaultDate.getFullYear()}`;
	};

	prevMonthBtn.onclick = function() {
		currentMonth--;
		if (currentMonth < 0) {
			currentMonth = 11;
			currentYear--;
		}
		renderCalendar(currentMonth, currentYear, selectedDate);
	};
	nextMonthBtn.onclick = function() {
		currentMonth++;
		if (currentMonth > 11) {
			currentMonth = 0;
			currentYear++;
		}
		renderCalendar(currentMonth, currentYear, selectedDate);
	};

	renderCalendar(currentMonth, currentYear);
	</script>
</body>
</html>